<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mesha Energy - DMS Diagnostics</title>
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/style.css" rel="stylesheet" type="text/css" />

    <link href="assets/owl/assets/owl.carousel.min.css" rel="stylesheet" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <!-- ag-chart -->
    <script src="https://cdn.jsdelivr.net/npm/ag-charts-community/dist/umd/ag-charts-community.js"></script>

    <style>
      body {
        /* background-color: #f8f9fa; */
        background-color: white;
      }

      /* dashboard */

      /*
 * Sidebar
 */

      /*
 * Navbar
 */

      .navbar-brand {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
        background-color: rgba(0, 0, 0, 0.25);
        box-shadow: inset -1px 0 0 rgba(0, 0, 0, 0.25);
      }

      .navbar .form-control {
        padding: 0.75rem 1rem;
      }

      .dropdown-toggle {
        outline: 0;
      }

      .btn-toggle {
        padding: 0.25rem 0.5rem;
        font-weight: 600;
        color: var(--bs-emphasis-color);
        background-color: transparent;
      }

      .btn-toggle:hover,
      .btn-toggle:focus {
        color: rgba(var(--bs-emphasis-color-rgb), 0.85);
        background-color: var(--bs-tertiary-bg);
      }

      .btn-toggle::before {
        width: 1.25em;
        line-height: 0;
        content: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='rgba%280,0,0,.5%29' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 14l6-6-6-6'/%3e%3c/svg%3e");
        transition: transform 0.35s ease;
        transform-origin: 0.5em 50%;
      }

      [data-bs-theme="dark"] .btn-toggle::before {
        content: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='rgba%28255,255,255,.5%29' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 14l6-6-6-6'/%3e%3c/svg%3e");
      }

      .btn-toggle[aria-expanded="true"] {
        color: rgba(var(--bs-emphasis-color-rgb), 0.85);
      }

      .btn-toggle[aria-expanded="true"]::before {
        transform: rotate(90deg);
      }

      .btn-toggle-nav a {
        padding: 0.1875rem 0.5rem;
        margin-top: 0.125rem;
        margin-left: 1.25rem;
      }

      .btn-toggle-nav a:hover,
      .btn-toggle-nav a:focus {
        background-color: var(--bs-tertiary-bg);
      }

      .scrollarea {
        overflow-y: auto;
      }

      .card-container {
        background-color: white;
        border-radius: 5px;
      }

      .color_box {
        padding-left: 2px;
        padding-right: 2px;
        height: 25px;
        border-radius: 4px;
        color: white;
        display: flex;
        justify-content: center;
        /* align-items: center; */
      }

      .lr_margin_10 {
        margin-left: 10px;
        margin-right: 10px;
      }

      .verticle_divide {
        border: 1px solid black;
        height: 20px;
      }

      .round_container {
        width: 20px;
        height: 20px;
        border-radius: 50%;
      }

      #devices {
        border: none;
        outline: none;
        font-size: 16px;
        font-weight: 500;
        height: 30px;
        background-color: #efefef;
        border-radius: 4px;
        padding: 0 8px;
      }
      @media (min-width: 768px) {
        .sidebar .offcanvas-lg {
          position: -webkit-sticky;
          position: sticky;
          top: 48px;
        }

        .navbar-search {
          display: block;
        }
      }

      .sidebar-heading {
        font-size: 0.75rem;
      }

      /*
 * Navbar
 */

      .navbar-brand {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
        background-color: rgba(0, 0, 0, 0.25);
        box-shadow: inset -1px 0 0 rgba(0, 0, 0, 0.25);
      }

      .navbar .form-control {
        padding: 0.75rem 1rem;
      }

      /* new-dashboard */

      /***upload***/
      .upload-container {
        max-width: 600px;
        margin: auto;
      }

      .image-preview {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 20px;
      }

      .image-preview img {
        max-width: 150px;
        max-height: 150px;
        position: relative;
      }

      .image-preview img:hover .delete-icon {
        display: block;
      }

      .delete-icon {
        display: none;
        position: absolute;
        top: 5px;
        right: 5px;
        background-color: rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        padding: 5px;
        cursor: pointer;
      }

      #drop-area {
        border: 2px dashed #ccc;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
      }

      #drop-area.highlight {
        background-color: #f0f0f0;
      }

      #fileInput {
        display: none;
      }
    </style>
  </head>

  <body>
    <!-- dashoard -->

    <header
      class="navbar sticky-top bg-dark flex-md-nowrap p-0 shadow d-block d-lg-none"
      data-bs-theme="dark"
    >
      <a
        class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6 text-white"
        href="#"
        >Company name</a
      >

      <ul class="navbar-nav flex-row d-md-none">
        <li class="nav-item text-nowrap">
          <button
            class="nav-link px-3 text-white"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSearch"
            aria-controls="navbarSearch"
            aria-expanded="false"
            aria-label="Toggle search"
          >
            <svg class="bi"><use xlink:href="#search" /></svg>
          </button>
        </li>
        <li class="nav-item text-nowrap">
          <button
            class="nav-link px-3 text-white"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#sidebarMenu"
            aria-controls="sidebarMenu"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <i class="bi bi-distribute-vertical"></i>
          </button>
        </li>
      </ul>

      <div id="navbarSearch" class="navbar-search w-100 collapse">
        <input
          class="form-control w-100 rounded-0 border-0"
          type="text"
          placeholder="Search"
          aria-label="Search"
        />
      </div>
    </header>

    <div class="container-fluid">
      <div class="row">
        <div
          class="sidebar col-md-3 col-lg-2 p-0 sd_br_h"
          style="
            /* border: 1px solid black !important; */
            height: 100vh;
            overflow-y: auto;
            position: sticky;
            top: 0;
            z-index: 1000;
            scrollbar-width: thin;
            width: 16%;
          "
        >
          <div
            class="offcanvas-md offcanvas-end"
            tabindex="-1"
            id="sidebarMenu"
            aria-labelledby="sidebarMenuLabel"
          >
            <div class="offcanvas-header">
              <h5 class="offcanvas-title" id="sidebarMenuLabel">
                Company name
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="offcanvas"
                data-bs-target="#sidebarMenu"
                aria-label="Close"
              ></button>
            </div>
            <div class="offcanvas-body d-md-flex flex-column p-0 pt-lg-3">
              <ul class="nav flex-column">
                <a href="dashboard.html">
                  <img
                    src="assets/img/mesha_inc_logo.png"
                    class="img-fluid sdbr_logo"
                    alt="logo"
                    style="
                      width: 100%;
                      height: auto;
                      padding: 0px 18px;
                      margin-top: 2px;
                      /* border: 1px solid black; */
                    "
                  />
                </a>
                <li class="nav-item">
                  <a
                    class="nav-link d-flex align-items-center gap-2 active"
                    style="color: #0d5e36"
                    aria-current="page"
                    href="dashboard.html"
                  >
                    <i class="bi bi-house sd_br_icn"></i> Dashboard
                  </a>
                </li>

                <li class="nav-item">
                  <a
                    class="nav-link d-flex align-items-center gap-2"
                    href="alldevices.html"
                  >
                    <i class="bi bi-ev-front"></i>
                    All Devices
                  </a>
                </li>
                <li class="nav-item">
                  <a
                    class="nav-link d-flex align-items-center gap-2"
                    href="alert_logs.html"
                  >
                    <i class="bi bi-exclamation-diamond"></i>
                    Alert Logs
                  </a>
                </li>
                <li class="nav-item">
                  <a
                    class="nav-link d-flex align-items-center gap-2"
                    href="reset.html"
                  >
                    <i class="bi bi-gear"></i>
                    Settings
                  </a>
                </li>
                <li class="nav-item" id="logoutBtn">
                  <a
                    class="nav-link d-flex align-items-center gap-2"
                    href="index.html"
                    ><i class="bi bi-power"></i> Log out
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <main
          class="col-md-9 ms-sm-auto col-lg-10 px-md-4"
          style="background-color: #f8f9fa; width: 84%; min-height: 100vh"
        >
          <div
            class="container-fluid mt-3 mb-3"
            style="background-color: #f8f9fa; margin: 0px"
          >
            <!-- <div class="row height d-flex align-items-center">
              <div class="col-md-6">
                <div class="form tp_srch">
                  <i class="bi bi-search tp_srch_icn"></i>
                  <input
                    type="text"
                    style="padding-left: 30px; background-color: #f8f9fa"
                    class="form-control form-input"
                    placeholder="Search"
                  />
                  <span class="left-pan"
                    ><i class="fa fa-microphone"> </i
                  ></span>
                </div>
              </div>
            </div> -->
          </div>

          <div
            class="container-fluid"
            id="dashboardContainer"
            style="background-color: #f8f9fa; padding: 20px; margin: 0px"
          >
            <div class="row">
              <div class="col-lg-12">
                <div class="ds_ttl_blk">
                  <h1 class="dh1">Device Parameters</h1>
                  <p class="dp1">
                    View/download detailed device parameters for multiple data
                    points
                  </p>
                </div>
              </div>
            </div>

            <div
              class="container-fluid mb-3"
              style="border-top: 1px solid #4a5154; opacity: 30%"
            ></div>

            <div class="d-flex justify-content-between">
              <div class="card-container">
                <div class="d-flex align-items-center">
                  <h1 class="dh1 lr_margin_10">
                    Customer Name - <span id="vendorName"></span>
                  </h1>
                  <div
                    id="statusDiv"
                    style="
                      display: flex;
                      gap: 8px;
                      justify-content: center;
                      align-items: center;
                      border: 1px solid balck;
                    "
                  ></div>

                  <div class="verticle_divide lr_margin_10"></div>
                  <h1 class="dh1 lr_margin_10">
                    Device Id-
                    <select id="devices" name="devices">
                      <option value=""></option>
                    </select>
                  </h1>
                  <div class="verticle_divide lr_margin_10"></div>
                  <h1 id="timeAndDate" class="dh1 lr_margin_10"></h1>
                </div>
              </div>
              <button
                class="btn btn-success"
                onclick="window.location.href='alldevices.html'"
              >
                Export Data Log
              </button>
              <a id="downloadLink" style="display: none"></a>
            </div>

            <section class="mt-3">
              <!-- <div class="container-fluid"> -->
              <div class="row">
                <div class="col-lg-3">
                  <div class="d-flex dsh_crd_bg align-items-center">
                    <div class="">
                      <h5 class="ds_crd_p1">Voltage 1 (B1)</h5>
                      <h6 id="v1" class="ds_crd_h6"></h6>
                      <!-- <p class="ds_crd_p2">
                  <i class="bi bi-arrow-up-short"></i> 6.7% Increase
                </p> -->
                    </div>
                    <div
                      style="
                        border: 1px solid #b9c907;
                        border-radius: 50%;
                        width: 50px;
                        height: 50px;
                      "
                    >
                      <img
                        src="assets/img/voltage.svg"
                        class="img-fluid dsh_crd_icn"
                        style="width: 100%"
                      />
                    </div>
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="d-flex dsh_crd_bg align-items-center">
                    <div class="">
                      <h5 class="ds_crd_p1">Voltage 2 (B2)</h5>
                      <h6 id="v2" class="ds_crd_h6"></h6>
                    </div>
                    <div
                      style="
                        border: 1px solid #b9c907;
                        border-radius: 50%;
                        width: 50px;
                        height: 50px;
                      "
                    >
                      <img
                        src="assets/img/voltage.svg"
                        class="img-fluid dsh_crd_icn"
                        style="width: 100%"
                      />
                    </div>
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="d-flex dsh_crd_bg align-items-center">
                    <div class="">
                      <h5 class="ds_crd_p1">Voltage 3 (B3)</h5>
                      <h6 id="v3" class="ds_crd_h6"></h6>
                    </div>
                    <div
                      style="
                        border: 1px solid #b9c907;
                        border-radius: 50%;
                        width: 50px;
                        height: 50px;
                      "
                    >
                      <img
                        src="assets/img/voltage.svg"
                        class="img-fluid dsh_crd_icn"
                        style="width: 100%"
                      />
                    </div>
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="d-flex dsh_crd_bg align-items-center">
                    <div class="">
                      <h5 class="ds_crd_p1">Voltage 4 (B4)</h5>
                      <h6 id="v4" class="ds_crd_h6"></h6>
                    </div>
                    <div
                      style="
                        border: 1px solid #b9c907;
                        border-radius: 50%;
                        width: 50px;
                        height: 50px;
                      "
                    >
                      <img
                        src="assets/img/voltage.svg"
                        class="img-fluid dsh_crd_icn"
                        style="width: 100%"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <!-- </div> -->
            </section>

            <section class="mt-3">
              <!-- <div class="container-fluid"> -->

              <div class="row">
                <div class="col-lg-3">
                  <div class="d-flex dsh_crd_bg align-items-center">
                    <div class="">
                      <h5 class="ds_crd_p1">Bat BANK VOLTAGE</h5>
                      <h6 id="totalVoltage" class="ds_crd_h6"></h6>
                    </div>
                    <div
                      style="
                        border: 1px solid #b9c907;
                        border-radius: 50%;
                        width: 50px;
                        height: 50px;
                      "
                    >
                      <img
                        src="assets/img/voltage.svg"
                        class="img-fluid dsh_crd_icn"
                        style="width: 100%"
                      />
                    </div>
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="d-flex dsh_crd_bg align-items-center">
                    <div class="">
                      <h5 class="ds_crd_p1">CURRENT (A)</h5>
                      <h6 id="current" class="ds_crd_h6"></h6>
                    </div>
                    <div
                      style="
                        border: 1px solid #0d5e36;
                        border-radius: 50%;
                        width: 50px;
                        height: 50px;
                      "
                    >
                      <img
                        src="assets/img/current.svg"
                        class="img-fluid dsh_crd_icn"
                        style="width: 100%"
                      />
                    </div>
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="d-flex dsh_crd_bg align-items-center">
                    <div class="">
                      <h5 class="ds_crd_p1">TEMPERATURE (T)</h5>
                      <h6 id="temperature" class="ds_crd_h6"></h6>
                    </div>
                    <div
                      style="
                        border: 1px solid #c38e3e;
                        border-radius: 50%;
                        width: 50px;
                        height: 50px;
                      "
                    >
                      <img
                        src="assets/img/temperature.svg"
                        class="img-fluid dsh_crd_icn"
                        style="width: 100%"
                      />
                    </div>
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="d-flex dsh_crd_bg align-items-center">
                    <div class="">
                      <h5 class="ds_crd_p1">Inst Speed (KMPH)</h5>
                      <h6 id="speed" class="ds_crd_h6"></h6>
                    </div>
                    <div
                      style="
                        border: 1px solid #3a3a38;
                        border-radius: 50%;
                        width: 50px;
                        height: 50px;
                      "
                    >
                      <img
                        src="assets/img/speed.svg"
                        class="img-fluid dsh_crd_icn"
                        style="width: 100%"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <!-- </div> -->
            </section>

            <section class="mt-3">
              <!-- <div class="container-fluid"> -->
              <div class="row">
                <div class="col-lg-3">
                  <div class="d-flex dsh_crd_bg align-items-center">
                    <div class="">
                      <h5 class="ds_crd_p1">KM driven today</h5>
                      <h6 class="ds_crd_h6" id="distance"></h6>
                    </div>
                    <div
                      style="
                        border: 1px solid #3a3a38;
                        border-radius: 50%;
                        width: 50px;
                        height: 50px;
                      "
                    >
                      <img
                        src="assets/img/distance.svg"
                        class="img-fluid dsh_crd_icn"
                        style="width: 100%"
                      />
                    </div>
                  </div>
                </div>
                <!-- <div class="col-lg-3">
                  <div class="d-flex dsh_crd_bg align-items-center">
                    <div class="">
                      <h5 class="ds_crd_p1">Version</h5>
                      <h6 class="ds_crd_h6" id="version"></h6>
                    </div>
                    <div
                      style="
                        border: 1px solid #3a3a38;
                        border-radius: 50%;
                        width: 50px;
                        height: 50px;
                      "
                    >
                      <img
                        src="assets/img/version.svg"
                        class="img-fluid dsh_crd_icn"
                        style="width: 100%"
                      />
                    </div>
                  </div>
                </div> -->
              </div>
              <!-- </div> -->
            </section>

            <!-- card -->

            <div
              class="container-fluid mb-3 mt-3"
              style="border-top: 1px solid #4a5154; opacity: 30%"
            ></div>

            <div class="agChartGraphsContainer">
              <div class="paginationWithHeading">
                <p>Graph Duration:</p>
                <div class="paginationContainer">
                  <button class="btn btn-outline-primary" id="prevPage">
                    Prev
                  </button>
                  <div>
                    <label for="pageSizeInput" hidden></label>
                    <input
                      class="form-control"
                      type="number"
                      id="pageSizeInput"
                      value="60"
                      min="10"
                      step="10"
                    />
                  </div>
                  <button class="btn btn-outline-primary" id="nextPage">
                    Next
                  </button>
                </div>
              </div>
              <div class="chartConatiner">
                <button class="refreshChart btn btn-outline-secondary btn-sm">
                  <i class="bi bi-arrow-clockwise"></i>
                </button>
                <div class="myChart" id="batteryVoltageChart"></div>
              </div>
              <div class="chartConatiner">
                <button class="refreshChart btn btn-outline-secondary btn-sm">
                  <i class="bi bi-arrow-clockwise"></i>
                </button>
                <div class="myChart" id="currentChart"></div>
              </div>
              <div class="chartConatiner">
                <button class="refreshChart btn btn-outline-secondary btn-sm">
                  <i class="bi bi-arrow-clockwise"></i>
                </button>
                <div class="myChart" id="bankVoltageChart"></div>
              </div>
            </div>

            <div
              class="container-fluid mb-3 mt-3"
              style="border-top: 1px solid #4a5154; opacity: 30%"
            ></div>

            <!-- table-top -->
            <div class="col">
              <div
                class="container-fluid"
                style="
                  background-color: white;
                  padding-left: 5px;
                  padding-top: 3px;
                  padding-bottom: 3px;
                  border-top-left-radius: 8px;
                  border-top-right-radius: 8px;
                "
              >
                <h1 class="dh1">Map View</h1>
                <div id="map" style="height: 700px; width: 100%"></div>
              </div>
            </div>
          </div>

          <div class="container-fluid mt-5">
            <div class="chargeDischargeHeading">
              <h2>Charge/Discharge Data</h2>
              <button
                class="btn btn-outline-secondary btn-sm"
                id="changeDischargeRefresh"
              >
                Refresh Data
              </button>
            </div>
            <table class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>Cycle Type</th>
                  <th>Date Time - From</th>
                  <th>Date Time - To</th>
                  <th>Distance Travelled</th>
                  <th>Duration - Hours</th>
                  <th>Temperature - Max</th>
                  <th>Temperature - Min</th>
                  <th>
                    AH <br />
                    In
                  </th>
                  <th>
                    AH <br />
                    Out
                  </th>
                  <th>B1</th>
                  <th>B2</th>
                  <th>B3</th>
                  <th>B4</th>
                  <th>Amps - Max</th>
                  <th>Amps - Min</th>
                  <th>Bank Voltage</th>
                </tr>
              </thead>
              <tbody id="data-table-body">
                <!-- Rows will be inserted here -->
              </tbody>
            </table>
          </div>
        </main>
      </div>
    </div>
    <!-- dashoard -->

    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/jquery-3.7.0.js"></script>
    <script src="assets/js/jquery-3.7.0.js"></script>
    <script src="assets/owl/owl.carousel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>

    <!--drag/drop-->
    <script>
      const dropArea = document.getElementById("drop-area");
      const fileInput = document.getElementById("fileInput");
      const uploadBtn = document.getElementById("uploadBtn");
      const imagePreview = document.querySelector(".image-preview");

      // Prevent default drag behaviors
      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        dropArea.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
      });

      // Highlight drop area when dragging over
      ["dragenter", "dragover"].forEach((eventName) => {
        dropArea.addEventListener(eventName, highlight, false);
      });

      // Unhighlight drop area when not dragging over
      ["dragleave", "drop"].forEach((eventName) => {
        dropArea.addEventListener(eventName, unhighlight, false);
      });

      // Handle dropped files
      dropArea.addEventListener("drop", handleDrop, false);

      function preventDefaults(event) {
        event.preventDefault();
        event.stopPropagation();
      }

      function highlight() {
        dropArea.classList.add("highlight");
      }

      function unhighlight() {
        dropArea.classList.remove("highlight");
      }

      function handleDrop(event) {
        const dt = event.dataTransfer;
        const files = dt.files;

        handleFiles(files);
      }

      function handleFiles(files) {
        for (const file of files) {
          const reader = new FileReader();
          reader.onload = function () {
            const imgElement = document.createElement("img");
            imgElement.src = reader.result;

            const deleteIcon = document.createElement("span");
            deleteIcon.classList.add("delete-icon");
            deleteIcon.innerHTML = '<i class="bi bi-trash"></i>';

            imgElement.appendChild(deleteIcon);
            imagePreview.appendChild(imgElement);

            // Add event listener to delete icon
            deleteIcon.addEventListener("click", function () {
              imgElement.remove();
            });
          };
          reader.readAsDataURL(file);
        }
      }

      // Open file dialog when upload button is clicked
      uploadBtn.addEventListener("click", function () {
        const images = imagePreview.querySelectorAll("img");
        const formData = new FormData();

        images.forEach((img) => {
          formData.append("images[]", img.src);
        });

        // Use fetch API to send data to the server or handle it accordingly
        fetch("your-upload-url", {
          method: "POST",
          body: formData,
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.text();
          })
          .then((text) => {
            console.log(text); // Do something with the response
          })
          .catch((error) => {
            console.error(
              "There was a problem with the fetch operation:",
              error
            );
          });
      });

      // Handle file input change
      fileInput.addEventListener("change", function () {
        const files = fileInput.files;
        handleFiles(files);
      });

      // Trigger file input click when clicking on the drop area
      dropArea.addEventListener("click", function () {
        fileInput.click();
      });
    </script>
    <!--drag/drop-->
    <!-- ag-chart start -->
    <script>
      // Function to fetch data from the API
      const pageSizeInput = document.getElementById("pageSizeInput");

      async function fetchData() {
        const deviceId = localStorage.getItem("selectedDeviceId");
        const authToken = localStorage.getItem("authToken");
        console.log({ deviceId, authToken });

        if (!deviceId || !authToken) {
          console.error("Device ID or Auth Token not found in local storage.");
          return [];
        }

        const url = `https://dms.meshaenergy.com/apis/graph/24hours/${deviceId}/${authToken}`;

        try {
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const result = await response.json();
          const dummy = [
            {
              b1: "12.61",
              b2: "12.55",
              b3: "12.54",
              b4: "12.49",
              charging_ah: "0.0",
              current: "-2.33",
              discharging_ah: "0.0999",
              lat: "2815.5036",
              log_date: "Mon, 21 Oct 2024 00:00:00 GMT",
              log_time: "16:52:12",
              long: "7751.183",
              row_num: 198,
              temperature: "37",
            },
            {
              b1: "12.65",
              b2: "12.56",
              b3: "12.57",
              b4: "12.50",
              charging_ah: "0.0",
              current: "-0.58",
              discharging_ah: "0.2131",
              lat: "2815.3792",
              log_date: "Mon, 21 Oct 2024 00:00:00 GMT",
              log_time: "16:54:12",
              long: "7751.081",
              row_num: 199,
              temperature: "37",
            },
          ];
          console.log({ datas: processApiData(dummy), result });
          // send only last 24hr data or less
          const pageSize = 1440;
          const lastIndex = result.length;
          const firstIndex = Math.max(0, lastIndex - pageSize);
          return processApiData(result.slice(firstIndex, lastIndex));
        } catch (error) {
          console.error("Error fetching data from API:", error);
          return [];
        }
      }

      // Function to process API data into the required format
      function processApiData(apiData) {
        return apiData
          .map((entry) => {
            try {
              // Calculate bank voltage as the sum of b1, b2, b3, and b4
              const bankVoltage =
                parseFloat(entry.b1) +
                parseFloat(entry.b2) +
                parseFloat(entry.b3) +
                parseFloat(entry.b4);

              // Format log_date to "YYYY-MM-DD" format
              const logDate = new Date(entry.log_date);
              const year = logDate.getUTCFullYear();
              const month = String(logDate.getUTCMonth() + 1).padStart(2, "0");
              const day = String(logDate.getUTCDate()).padStart(2, "0");

              // Combine log_date and log_time into an ISO 8601 format string
              const fullDateTimeStr = `${year}-${month}-${day}T${entry.log_time}`;

              // Create a Date object with the combined date and time
              const fullDateTime = new Date(fullDateTimeStr);

              // Check if the combined date and time is valid
              if (isNaN(fullDateTime.getTime())) {
                console.error(
                  "Invalid date and time:",
                  entry.log_date,
                  entry.log_time
                );
                return null; // Skip this entry if invalid
              }

              // Format time to hh:mm:ss AM/PM
              const formattedTime = fullDateTime.toLocaleTimeString([], {
                hour: "2-digit",
                minute: "2-digit",
                second: "2-digit",
                hour12: true,
              });

              return {
                full_date_time: fullDateTime, // For unique filtering or sorting
                log_time: formattedTime, // For display purposes
                b1: parseFloat(entry.b1),
                b2: parseFloat(entry.b2),
                b3: parseFloat(entry.b3),
                b4: parseFloat(entry.b4),
                current: parseFloat(entry.current),
                bank_voltage: parseFloat(bankVoltage.toFixed(2)),
              };
            } catch (error) {
              console.error("Error processing entry:", entry, error);
              return null; // Skip entry on error
            }
          })
          .filter((entry) => entry !== null); // Remove invalid entries
      }

      // Function to update the charts with new data
      let pageSize = 60; // Default page size
      let totalData = []; // To store the complete data array
      // console.log({ totalData });
      let currentPage = Math.ceil(totalData.length / pageSize); // Current page index should be eqral to last page

      function getPaginatedData() {
        const endIndex =
          totalData.length -
          (Math.ceil(totalData.length / pageSize) - currentPage - 1) * pageSize; // Calculate the end index
        const startIndex = Math.max(0, endIndex - pageSize); // Ensure the start index is not negative
        console.log({ startIndex, endIndex });

        return totalData.slice(startIndex, endIndex); // Return the sliced data
      }

      function updatePaginationButtons() {
        const totalPages = Math.ceil(totalData.length / pageSize);
        document.getElementById("prevPage").disabled = currentPage <= 0;
        document.getElementById("nextPage").disabled =
          currentPage >= totalPages - 1;
      }

      async function updateCharts() {
        document.getElementById("batteryVoltageChart").innerHTML = "";
        document.getElementById("currentChart").innerHTML = "";
        document.getElementById("bankVoltageChart").innerHTML = "";

        const paginatedData = getPaginatedData();

        if (paginatedData.length === 0) {
          console.log("No data available to display on the charts.");
          // return;
        }

        // First Chart: Battery Voltages
        const batteryVoltageOptions = {
          container: document.getElementById("batteryVoltageChart"),
          title: {
            text: "Individual Battery Voltage (Up to 24 hrs)",
          },
          data: paginatedData,
          series: [
            {
              type: "line",
              xKey: "full_date_time", // Use full_date_time for unique values
              xName: "Date & Time", // Tooltip shows both date and time
              yKey: "b1",
              yName: "B1",
              stroke: "#5D49F2",
              interpolation: { type: "smooth" },
              marker: { enabled: false },
            },
            {
              type: "line",
              xKey: "full_date_time", // Use full_date_time for unique values
              xName: "Date & Time", // Tooltip shows both date and time
              yKey: "b2",
              yName: "B2",
              stroke: "#438A3F",
              interpolation: { type: "smooth" },
              marker: { enabled: false },
            },
            {
              type: "line",
              xKey: "full_date_time", // Use full_date_time for unique values
              xName: "Date & Time", // Tooltip shows both date and time
              yKey: "b3",
              yName: "B3",
              stroke: "#F41A1A",
              interpolation: { type: "smooth" },
              marker: { enabled: false },
            },
            {
              type: "line",
              xKey: "full_date_time", // Use full_date_time for unique values
              xName: "Date & Time", // Tooltip shows both date and time
              yKey: "b4",
              yName: "B4",
              stroke: "#CD8A05",
              interpolation: { type: "smooth" },
              marker: { enabled: false },
            },
          ],
          axes: [
            {
              type: "time", // Use a time axis to support full_date_time
              position: "bottom",
              title: { text: "Time (hh:mm:ss)" },
              label: {
                formatter: (params) => {
                  // Format axis labels to show only time
                  const date = new Date(params.value);
                  return date.toLocaleTimeString([], {
                    hour: "2-digit",
                    minute: "2-digit",
                    second: "2-digit",
                  });
                },
                rotation: -30,
              },
            },
            {
              type: "number",
              position: "left",
              title: { text: "Voltage (V)" },
            },
          ],
        };
        agCharts.AgCharts.create(batteryVoltageOptions);

        // Second Chart: Current
        const currentOptions = {
          container: document.getElementById("currentChart"),
          title: { text: "Current (Up to 24 hrs)" },
          data: paginatedData, // Use the processed data
          series: [
            {
              type: "line",
              xKey: "full_date_time", // Use full_date_time for unique values
              xName: "Date & Time", // Tooltip shows both date and time
              yKey: "current",
              yName: "Current (A)",
              stroke: "#438A3F",
              interpolation: { type: "smooth" },
              marker: { enabled: false },
            },
          ],
          axes: [
            {
              type: "time", // Use a time axis to support full_date_time
              position: "bottom",
              title: { text: "Time (hh:mm:ss)" },
              label: {
                formatter: (params) => {
                  // Format axis labels to show only time
                  const date = new Date(params.value);
                  return date.toLocaleTimeString([], {
                    hour: "2-digit",
                    minute: "2-digit",
                    second: "2-digit",
                  });
                },
                rotation: -30,
              },
            },
            {
              type: "number",
              position: "left",
              title: { text: "Current (A)" },
            },
          ],
        };
        agCharts.AgCharts.create(currentOptions);

        // Third Chart: Bank Voltage
        const bankVoltageOptions = {
          container: document.getElementById("bankVoltageChart"),
          title: { text: "Bank Voltage (Up to 24 hrs)" },
          data: paginatedData,
          series: [
            {
              type: "line",
              xKey: "full_date_time", // Use full_date_time for unique values
              xName: "Date & Time", // Tooltip shows both date and time
              yKey: "bank_voltage",
              yName: "Bank Voltage",
              stroke: "#233105",
              interpolation: { type: "smooth" },
              marker: { enabled: false },
            },
          ],
          axes: [
            {
              type: "time", // Use a time axis to support full_date_time
              position: "bottom",
              title: { text: "Time (hh:mm:ss)" },
              label: {
                formatter: (params) => {
                  // Format axis labels to show only time
                  const date = new Date(params.value);
                  return date.toLocaleTimeString([], {
                    hour: "2-digit",
                    minute: "2-digit",
                    second: "2-digit",
                  });
                },
                rotation: -30,
              },
            },
            {
              type: "number",
              position: "left",
              title: { text: "Voltage (V)" },
            },
          ],
        };
        agCharts.AgCharts.create(bankVoltageOptions);
      }

      async function initializeChart() {
        totalData = await fetchData();
        console.log({ totalData });
        currentPage = Math.ceil(totalData.length / pageSize) - 1;
        pageSizeInput.setAttribute("max", totalData.length);

        updateCharts();
        updatePaginationButtons();
      }

      document.getElementById("prevPage").addEventListener("click", () => {
        if (currentPage > 0) {
          currentPage--;
          updateCharts();
          updatePaginationButtons();
        }
      });

      document.getElementById("nextPage").addEventListener("click", () => {
        const totalPages = Math.ceil(totalData.length / pageSize);
        if (currentPage < totalPages - 1) {
          currentPage++;
          updateCharts();
          updatePaginationButtons();
        }
      });

      pageSizeInput.addEventListener("change", (event) => {
        const newSize = parseInt(event.target.value, 10);
        if (newSize > 0) {
          pageSize = newSize;
          currentPage = Math.ceil(totalData.length / pageSize) - 1; // Reset to the first page
          updateCharts();
          updatePaginationButtons();
        }
        if (newSize > totalData.length) {
          pageSizeInput.value = totalData.length;
          pageSize = totalData.length;
          currentPage = Math.ceil(totalData.length / pageSize) - 1;
          updateCharts();
          updatePaginationButtons();
        } else if (newSize < 10) {
          pageSizeInput.value = 10;
          pageSize = 10;
          currentPage = Math.ceil(totalData.length / pageSize) - 1;
          updateCharts();
          updatePaginationButtons();
        }
      });

      initializeChart();

      // Refresh charts every minute
      // var graphIntervalId;
      // graphIntervalId = setInterval(updateCharts, 30000);
      let refreshButtons = document.querySelectorAll(".refreshChart");

      for (let i = 0; i < refreshButtons.length; i++) {
        refreshButtons[i].addEventListener("click", initializeChart);
      }
    </script>
    <!-- ag-chart end -->
  </body>
</html>
<script src="./assets/js/dashboard.js"></script>
<!-- <script src="./assets/js/module_permission.js"></script> -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDimDjoGeaoSdHBzihrmYnscbcALzfFQ24&callback=initMap"></script>
